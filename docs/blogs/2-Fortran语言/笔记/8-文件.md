# 08-æ–‡ä»¶

## æ–‡ä»¶çš„æ“ä½œ

### æ¦‚è¿°

- æ‰“å¼€æ–‡ä»¶ open
- è¯»å†™æ–‡ä»¶ read write
- å…³é—­æ–‡ä»¶ close
- æŸ¥è¯¢æ–‡ä»¶ inquire
- å…¶å®ƒå‘½ä»¤

### opençš„ä½¿ç”¨

open ï¼šæ‰“å¼€æ–‡ä»¶ ï¼ˆå…³è”ä¸€ä¸ªæ–‡ä»¶ä¸é€šé“ï¼‰

opençš„å‚æ•°

```c
open( [unit=]number [,file='filename'] [,form='...'] [,status='...'] [,access='...']
[,recl=length] [,err=label] [,iostat=iostat] [,blank='...'] [,position='...']
[,action=action] [,pad='...'] [,delim='...'])
```

- `[unit=]number`: æŒ‡å®šæ–‡ä»¶çš„é€»è¾‘å•å…ƒå·ï¼ˆunit numberï¼‰ã€‚
	- å…¶ä¸­ï¼Œunit= å¯ä»¥è¿›è¡Œçœç•¥
	- number å¿…é¡»ä¸ºæ­£æ•´æ•°
	- number å¯ä»¥ä½¿ç”¨å˜é‡æˆ–å¸¸é‡è¿›è¡Œèµ‹å€¼
	- number åº”è¯¥å°½é‡é¿å…ä½¿ç”¨5å’Œ6ï¼ˆ<font color="##c00000">5é»˜è®¤æ˜¯é”®ç›˜è¾“å…¥ï¼Œ6é»˜è®¤æ˜¯å±å¹•è¾“å‡º</font>ï¼‰
- `[,file='filename']`: æŒ‡å®šæ–‡ä»¶çš„åç§°ã€‚
	- æ–‡ä»¶åè¦ç¬¦åˆæ“ä½œç³»ç»Ÿçš„è§„å®š
	- é¿å…ä½¿ç”¨ä¸­æ–‡å­—ç¬¦
- `[,form='...']`: æŒ‡å®šæ–‡ä»¶çš„æ ¼å¼ã€‚
	- `formatted` è¡¨ç¤ºæ–‡ä»¶ä½¿ç”¨**æ–‡æœ¬æ–‡ä»¶**æ ¼å¼æ¥ä¿å­˜
	- `unformatted `è¡¨ç¤ºæ–‡ä»¶ä½¿ç”¨**äºŒè¿›åˆ¶æ–‡ä»¶**æ ¼å¼æ¥ä¿å­˜
- `[,status='...']`: æŒ‡å®šæ–‡ä»¶çš„çŠ¶æ€ã€‚
	- newï¼šæ–°å»ºæ–‡ä»¶
	- oldï¼šæ‰“å¼€å·²æœ‰æ–‡ä»¶
	- replaceï¼š æ›¿æ¢å·²æœ‰æ–‡ä»¶æˆ–æ–°å»ºæ–‡ä»¶
	- scratchï¼šæ‰“å¼€ä¸€ä¸ªæš‚å­˜ç›˜ï¼Œä¸éœ€è¦æŒ‡å®šæ–‡ä»¶åï¼Œç¨‹åºç»“æŸåè‡ªåŠ¨åˆ é™¤
	- unknownï¼šç”±ç¼–è¯‘å™¨è‡ªå®šä¹‰ï¼Œé€šå¸¸ä¸ºæ–°å»ºæ–‡ä»¶æˆ–æ‰“å¼€å·²æœ‰æ–‡ä»¶ï¼ˆå¦‚æœæœ‰å†™å…¥ï¼Œä¼šè¦†ç›–åŸæœ‰çš„å†…å®¹ï¼‰
- `[,access='...']`: æŒ‡å®šæ–‡ä»¶çš„è®¿é—®æ–¹å¼ ^69cf05
	- `'sequential'` è¡¨ç¤ºé¡ºåºè®¿é—® **é»˜è®¤å€¼**
	- `'direct'` è¡¨ç¤ºç›´æ¥è®¿é—® ï¼ˆå¯æŒ‡å®šä»»æ„ä½ç½®ï¼‰
- `[,recl=length]`: é¡ºåºè¯»å–æ–‡ä»¶æ—¶ï¼Œè®¾ç½®ä¸€æ¬¡å¯ä»¥è¯»å†™å¤šå¤§å®¹é‡çš„æ•°æ®
	- ç›´æ¥è¯»å–æ–‡ä»¶æ—¶ï¼Œè®¾ç½®æ–‡ä»¶ä¸­æ¯ä¸ªæ¨¡å—å•å…ƒçš„åˆ†åŒºé•¿åº¦
	- å•ä½
		- åœ¨æ–‡æœ¬æ ¼å¼ä¸‹ï¼Œä¸ºä¸€ä¸ªå­—ç¬¦ï¼ˆ1Bï¼‰
		- åœ¨äºŒè¿›åˆ¶æ ¼å¼ä¸‹ï¼Œç”±ç¼–è¯‘å™¨å†³å®šï¼ˆ1Bæˆ–4Bï¼‰
- `[,err=label]`: è®¾ç½®å½“æ–‡ä»¶æ‰“å¼€å‘ç”Ÿé”™è¯¯æ—¶ï¼Œç¨‹åºä¼šè·³åˆ°ä»£ç ä¸ºlableçš„è¡Œç»§ç»­æ‰§è¡Œã€‚
	- 1-99999èŒƒå›´å†…çš„æ•´æ•°
- `[,iostat=var]`: è¿”å›æ–‡ä»¶æ“ä½œçš„çŠ¶æ€ç ã€‚ ^ccb47a
	- è¿”å›ä¸€ä¸ªå€¼ç»™å˜é‡varï¼Œç”¨æ¥è¯´æ˜æ–‡ä»¶æ‰“å¡çš„çŠ¶æ€
	- $var>0$ï¼šè¡¨ç¤ºæ–‡ä»¶è¯»å–æ“ä½œå‘ç”Ÿé”™è¯¯
	- $var=0$ï¼šè¡¨ç¤ºè¯»å–æ“ä½œæ­£å¸¸
	- $var<0$ï¼šè¡¨ç¤ºæ–‡ä»¶ç»ˆäº†
- `[,blank='...']`: è®¾ç½®æ–‡ä»¶è¾“å…¥æ•°å­—æ—¶ï¼Œå½“æ‰€è®¾ç½®çš„æ ¼å¼å­—æ®µä¸­æœ‰ç©ºæ ¼å­˜åœ¨æ—¶ï¼Œæ‰€ä»£è¡¨çš„æ„ä¹‰
	- `null`  ï¼šè¡¨ç¤ºç©ºæ ¼ä»£è¡¨æ²¡æœ‰ä¸œè¥¿ï¼ˆ<font color="##e36c09">é»˜è®¤</font>ï¼‰
	- `zero` ï¼šç©ºæ ¼è‡ªåŠ¨ä»¥0ä»£æ›¿
- `[,position='...']`: æŒ‡å®šæ–‡ä»¶æ‰“å¼€æ—¶çš„è¯»å†™åˆå§‹ä½ç½®
	- `rewind` è¡¨ç¤ºå°†æ–‡ä»¶æŒ‡é’ˆé‡ç½®åˆ°å¼€å¤´
	- `asis` è¡¨ç¤ºä¸ç‰¹åˆ«æŒ‡å®šï¼Œé€šå¸¸åœ¨æ–‡ä»¶å¼€å¤´ï¼ˆ<font color="##e36c09">é»˜è®¤</font>ï¼‰
	- `append` è¡¨ç¤ºç§»åˆ°æ–‡ä»¶ç»“å°¾ï¼ˆå¤šç”¨äºç»­å†™æ–‡ä»¶ï¼‰
- `[,action=...]`: è®¾ç½®æ‰“å¼€æ–‡ä»¶çš„è¯»å†™æƒé™ï¼Œé¿å…è¯¯å†™ 
	- readwrite ï¼šè¡¨ç¤ºå¯è¯»å–å’Œå†™å…¥ï¼ˆ<font color="##e36c09">é»˜è®¤</font>ï¼‰
	- readï¼šè¡¨ç¤ºåªèƒ½è¯»å–
	- writeï¼šè¡¨ç¤ºåªèƒ½å†™å…¥
- `[,pad='...']`: ç¡®å®šæ ¼å¼åŒ–è¾“å…¥æ—¶ï¼Œå‰é¢ä¸è¶³çš„å­—æ®µæ˜¯å¦è¦è‡ªåŠ¨ä»¥ç©ºæ ¼è¿›è¡Œå¡«å……
	- yes 
	- no
- `[,delim='...']`: æŒ‡å®šå­—ç¬¦ä¸²ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚
	- none ï¼šåªè¾“å‡ºå­—ç¬¦ä¸²çš„å†…å®¹ï¼ˆ<font color="##e36c09">é»˜è®¤</font>ï¼‰
	- quoteï¼šè¾“å‡ºå­—ç¬¦ä¸²ä¼šåœ¨å‰ååŠ ä¸ŠåŒå¼•å·
	- apostrophe: è¾“å‡ºå­—ç¬¦ä¸²æ—¶ä¼šåœ¨å‰ååŠ ä¸Šå•å¼•å·

### read å’Œ writeçš„ä½¿ç”¨

```c
read/write	([unit=]number [,fmt=format] [,rec=record] [,iostat=stat]	
			[,err=errlabel]	[,end=endlabel]	[,advance=advance] [,size=size])
```

- `([unit=]number`: æŒ‡å®šæ–‡ä»¶çš„é€»è¾‘å•å…ƒå·ï¼ˆunit numberï¼‰ã€‚
- `[,fmt=format]`: æŒ‡å®šæ ¼å¼æ§åˆ¶ã€‚
- `[,rec=record]`: åœ¨ç›´æ¥è¯»å–æ–‡ä»¶ä¸­ï¼Œè®¾ç½®è¯»å†™çš„æ–‡ä»¶æ¨¡å—ä½ç½®ã€‚
- `[,iostat=stat]`: è¿”å›è¯»å–æˆ–å†™å…¥æ“ä½œçš„çŠ¶æ€ç ã€‚
	- ![[8-æ–‡ä»¶##^ccb47a]]
- `[,err=errlabel]`: è¡¨ç¤ºåœ¨è¯»å†™è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¼šè·³åˆ°ä»£ç ä¸ºerrlableçš„è¡Œç»§ç»­æ‰§è¡Œã€‚
- `[,end=endlabel]`: è¡¨ç¤ºè¯»å†™åˆ°æ–‡ä»¶æœ«å°¾æ—¶ï¼Œè·³åˆ°ä»£ç ä¸ºendlableçš„è¡Œç»§ç»­æ‰§è¡Œã€‚
- `[,advance=advance]`
	- è®¾ç½®åœ¨æ–‡æœ¬æ ¼å¼ä¸‹çš„é¡ºåºæ–‡ä»¶ä¸­ï¼Œæ¯ä¸€æ¬¡çš„è¯»å†™å‘½ä»¤å®Œæˆåï¼Œè¯»å†™ä½ç½®æ˜¯å¦è‡ªåŠ¨å‘ä¸‹ç§»åŠ¨ä¸€è¡Œã€‚
		- yes ï¼ˆ<font color="##e36c09">é»˜è®¤</font>ï¼‰
		- no
- `[,size=count]`: 
	- å½“advance='no'æ—¶ï¼Œè¿”å›æ­¤æ¬¡è¾“å…¥/è¾“å‡ºçš„å­—ç¬¦æ•°ç›®ç»™æ•´å‹å˜é‡count

### closeçš„ä½¿ç”¨
`
```c
close ([unit=] number [,status=string] [,err=errlabel] [,iostat=iostat])
```

- status : å†³å®šæ–‡ä»¶å…³é—­åçš„æ“ä½œ
	- keep æˆ– save ï¼šè¡¨ç¤ºåœ¨æ–‡ä»¶å…³é—­åï¼Œä¿ç•™è¯¥æ–‡ä»¶ï¼ˆ<font color="##e36c09">é»˜è®¤</font>ï¼‰
	- delete ï¼š è¡¨ç¤ºè¯¥æ–‡ä»¶å…³é—­åï¼Œåˆ é™¤è¯¥æ–‡ä»¶

### æŸ¥è¯¢æ–‡ä»¶çš„çŠ¶æ€

æ³¨æ„ğŸ“¢ï¼šå¯ä»¥é‡‡ç”¨é€šé“å·æˆ–æ–‡ä»¶åæ¥æŸ¥è¯¢æ–‡ä»¶ï¼Œä½†æ˜¯ï¼Œä»¥ä¸Šä¸¤ç§æ–¹å¼åªèƒ½é€‰æ‹©ä¸€ç§è¿›è¡Œä½¿ç”¨

```c
inquire ([unit=number] [,file='filename'] [,iostat=stat] [,err=label] [,exist=exist]
[,opened=opened] [,sequential=sequential] [,direct=direct] [,form=form]	[,formatted=formatted]	
[,unformatted=unformatted]	[,recl=recl])
```

- `exist`ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
	- è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»™é€»è¾‘å˜é‡`exist`
	- çœŸå€¼ï¼Œè¡¨ç¤ºæ–‡ä»¶å­˜åœ¨
	- å‡å€¼ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸å­˜åœ¨
- `opened` : æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»ä½¿ç”¨openå‘½ä»¤æ‰“å¼€
- `number`ï¼šç”±æ–‡ä»¶åæ¥æŸ¥è¯¢è¯¥æ–‡ä»¶çš„é€šé“å·
- `named`ï¼šæŸ¥è¯¢æ–‡ä»¶æ˜¯å¦å–äº†åå­—
- `access`ï¼šæ£€æŸ¥æ–‡ä»¶çš„è¯»å–æ ¼å¼ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»™å­—ç¬¦å‹å˜é‡access
	- `'sequential'`Â è¡¨ç¤ºé¡ºåºè®¿é—®Â **é»˜è®¤å€¼**
	- `'direct'`Â è¡¨ç¤ºç›´æ¥è®¿é—® ï¼ˆå¯æŒ‡å®šä»»æ„ä½ç½®ï¼‰
	- `undefined`:è¡¨ç¤ºæ²¡æœ‰å®šä¹‰
	- ![[8-æ–‡ä»¶##^69cf05]]
- `sequential`ï¼šæŸ¥çœ‹æ–‡ä»¶æ˜¯å¦ä½¿ç”¨é¡ºåºæ ¼å¼
- `direct`ï¼šæŸ¥çœ‹æ–‡ä»¶æ˜¯å¦ä½¿ç”¨ç›´æ¥æ ¼å¼
- `form` æŸ¥çœ‹æ–‡ä»¶çš„ä¿å­˜æ–¹æ³•
- `unformatted`ï¼šæŸ¥çœ‹æ–‡ä»¶æ˜¯å¦ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶
- `formatted` ï¼š æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦ä¸ºæ–‡æœ¬æ–‡ä»¶

### å…¶å®ƒæ–‡ä»¶è¿è¡Œå‘½ä»¤

- `backspace(unit=number,err=lable,iostat=stat)`
	- æŠŠæ–‡ä»¶çš„è¯»å†™ä½ç½®é€€å›ä¸€æ­¥
- `endfile(unit=number,err=errlable,iostat=stat)`
	- æŠŠæ–‡ä»¶çš„è¯»å†™ä½ç½®è®¾ä¸ºæ–‡ä»¶æœ«å°¾
- `rewind(unit=number,err=lable,iostat=stat)`
	- æŠŠæ–‡ä»¶çš„è¯»å†™ä½ç½®å€’å›æ–‡ä»¶å¼€å¤´

## é¡ºåºæ–‡ä»¶çš„æ“ä½œ

é¡ºåºæ–‡ä»¶åœ¨è¯»å†™æ—¶ï¼Œä¸èƒ½ä»»æ„èµ‹å€¼åˆ°æ–‡ä»¶çš„æŸä¸ªä½ç½®è¯»å†™æ•°æ®ï¼Œåªèƒ½ä»å¤´å¼€å§‹ä¸€æ­¥æ­¥å‘ä¸‹è¿›è¡Œã€‚

æ”¹å˜æ–‡ä»¶è¯»å†™ä½ ç½®æ—¶ï¼Œåªèƒ½ä¸€æ­¥æ­¥åœ°è¿›é€€ï¼Œæˆ–æ˜¯ç›´æ¥ç§»å›æ–‡ä»¶å¼€å¤´ã€‚

ä¾‹å¦‚ï¼šæ–‡æœ¬æ–‡ä»¶

```c
program main
	implicit none
	character (len=79)	::	filename
	character (len=79)	::	buffer
	integer,parameter :: fileid =	10
	integer ::	status	=	0
	logical alive
	
	write (*,*)	"Filename:"
	read (*,"(A79)")filename
	inquire (file=filename,	exist=alive)
	if (alive)	then
		open (unit=fileid,	file=filename,	access="sequential",	status="old")
		do while (.true.)
			read (unit=fileid,fmt="(A79)",iostat=status) buffer
			if (status/=0)	exit !æ²¡æœ‰æ•°æ®å°±è·³å‡ºå¾ªç¯
			write (*,"(A79)")buffer
		end do
	else
		write (*,*)	 trim(filename),"doesn't exist."
	end if
	
	stop
end
```

![[è¯»æ–‡ä»¶ç¤ºä¾‹.excalidraw|center|800]]

## ç›´æ¥è®¿é—®æ–‡ä»¶çš„æ“ä½œ

ç›´æ¥è®¿é—®æ–‡ä»¶ï¼Œæ˜¯æŠŠæ–‡ä»¶çš„ç©ºé—´ã€å†…å®¹äº‹å…ˆåˆ†åŒºæˆå¥½å‡ ä¸ªåŒæ ·å¤§å°çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—ä¼šè‡ªåŠ¨æŒ‰é¡ºåºç¼–å·ã€‚

è¯»å†™æ–‡ä»¶æ˜¯ï¼Œè¦å…ˆèµ‹å€¼æ–‡ä»¶è¯»å†™ä½ç½®åœ¨ç¬¬å‡ ä¸ªæ¨¡å—ï¼Œå†æ¥è¿›è¡Œè¯»å†™çš„å·¥ä½œã€‚

ç›´æ¥è®¿é—®æ–‡ä»¶å¯ä»¥ä»»æ„åˆ°æ–‡ä»¶çš„ä»»ä¸€ä¸ªæ¨¡å—æ¥è¯»å†™ã€‚

```c
program main
	implicit none
	integer,parameter ::	fileid =	10
	character (len=20)	::	filename	=	"list.txt"
	integer player
	real hit
	integer error
	logical alive
	inquire (file=filename,	exist=alive)
	if (.not.alive)	then
		write(*,*)	trim (filename),"doesn't exist."
		stop
	end if
	open (unit=fileid,file=filename,access="direct",form="formatted",recl=6,status="old")
	do while (.true.)
		write(*,"('æŸ¥è¯¢ç¬¬å‡ æ£’?')")
		read (*,*)	player
		read (fileid,	fmt="(F4.2)",	rec=player,	IOSTAT=error)	hit
		if (error/=0)	exit
		write(*,"('æ‰“å‡»ç‡:'F4.2)")	hit
	end do
	close (fileid)
	stop
end program
```

## äºŒè¿›åˆ¶æ–‡ä»¶çš„è¯»å–

```c
program	main
	implicit none
	integer,parameter ::fileid = 10
	character (len=20)	::	filename = "list.bin"
	integer player
	real ::	hit(9) = (/3.2,2.8,3.3,3.2,2.9,2.7,2.2,2.3,1.9/)
	open (unit=fileid,file=filename,access="direct",recl=4,	status="replace") 
	do player=1,9	
		write (fileid,rec=player)	hit(player)
	end do
	close (fileid)
	stop
end program main
```

